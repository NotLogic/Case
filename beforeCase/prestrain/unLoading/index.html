<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/preload.css">
</head>
<body>
    <div class="box">
        <img src="http://attach.bbs.miui.com/forum/201605/11/163014tkjbn8bj8z7b2wk0.jpg" alt="pic" id="img">
        <p>
            <a href="javascript:;" class="btn" data-control="prev">上一页</a>
            <a href="javascript:;" class="btn" data-control="next">上一页</a>
        </p>
    </div>
    <div class="loading">
        <p class="progress">0%</p>
    </div>
    <script src="../../bower_components/jquery/dist/jquery.js"></script>
    <script src="./js/preload.js"></script>
    <script>
        
    //     var imgs = [
    //     'http://attach.bbs.miui.com/forum/201605/11/163014tkjbn8bj8z7b2wk0.jpg',
    //     'http://i1.hdslb.com/bfs/archive/85b0b71490be30e0ace5fafb9e261675e032b4bb.jpg',
    //     'http://img1.3lian.com/2015/a1/66/d/174.jpg',
    //     'http://attach.bbs.miui.com/forum/201207/27/141425t22jho52nup5y511.jpg'
    // ]

    // var index = 0
    // var len = imgs.length
    // var count = 0
    // $progress = $('.progress')

    // $.each(imgs, function(i , src){
    //     var imgObj = new Image()

    //     $(imgObj).on('load error', function(){
    //         $progress.html(Math.round( (count + 1) / len * 100  ) + '%')

    //         if(count >= len -1){
    //             $('.loading').hide()
    //             document.title = '1/'+ len
    //         }
    //         count++
    //     })
    //     imgObj.src = src
    // })

    // $('.btn').on('click',function(){
    //     if( 'prev' ===  $(this).data('control') ){
    //         // index = Math.max(0, --index)
    //         index--
    //         if(index < 0){
    //             index = len-1
    //         }
            
    //     }else{
    //         // index = Math.min(len - 1 ,++index)
    //         index++
    //         if(index >len-1){
    //             index = 0
    //         }
           
    //     }
    //     document.title =  (index +1)+ '/' +len
    //     $('#img').attr('src', imgs[index])
    // })
            



    
    var imgs = [
        'http://attach.bbs.miui.com/forum/201605/11/163014tkjbn8bj8z7b2wk0.jpg',
        'http://i1.hdslb.com/bfs/archive/85b0b71490be30e0ace5fafb9e261675e032b4bb.jpg',
        'http://img1.3lian.com/2015/a1/66/d/174.jpg',
        'http://attach.bbs.miui.com/forum/201207/27/141425t22jho52nup5y511.jpg'
    ]

    var index = 0
    var len = imgs.length
    var count = 0
    $progress = $('.progress')

    $.preload(imgs, {
        each:function(count){
            $progress.html(Math.round( (count + 1) / len * 100  ) + '%')
        },
        all:function(){
            $('.loading').hide()
            document.title = '1/'+ len
        }
    })


    $('.btn').on('click',function(){
        if( 'prev' ===  $(this).data('control') ){
            // index = Math.max(0, --index)
            index--
            if(index < 0){
                index = len-1
            }
            
        }else{
            // index = Math.min(len - 1 ,++index)
            index++
            if(index >len-1){
                index = 0
            }
           
        }
        document.title =  (index +1)+ '/' +len
        $('#img').attr('src', imgs[index])
    })
    </script>
</body>
</html>